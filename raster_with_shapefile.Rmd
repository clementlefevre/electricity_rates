---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

```{r}
library(ncdf4)
library(raster)
library(sp)
library(rgeos)
library(rgdal)
```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).
```{r}

r<-rotate(raster('gis/noaa_temperatures/air.mon.mean.nc',band=100))


e <- extent(-120,-70,0,40)
rc <- crop(r, e)


plot(rc)

```
```{r}
myshp<-readOGR(dsn="gis/shapefiles/conjunto_de_datos/",layer = "areas_geoestadisticas_municipales")

```

```{r}

# tranform both data set to longlat

rgeo <- projectRaster(rc, crs='+proj=longlat +datum=WGS84')
pgeo <- spTransform(myshp, CRS('+proj=longlat +datum=WGS84'))

# plot on top of Google map
library(dismo)
e <- union(extent(rc), extent(pgeo))
print( e)
g <- gmap(e,lonlat=TRUE)
plot(g, inter=TRUE)
plot(extent(rc), add=TRUE, col='red', lwd=2)
plot(pgeo, add=TRUE, col='blue', lwd=2)
```

```{r}
extraction <-extract(rgeo,pgeo,weights = TRUE, normalizeWeights=TRUE, fun=mean)
df<-as.data.frame(extraction)
```
```{r}
pgeo@data <- data.frame(pgeo@data, means=extraction)
  str(pgeo@data)
spplot(pgeo, "means")
```

