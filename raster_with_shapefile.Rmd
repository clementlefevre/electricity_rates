---
title: "Combine Raster temperature with Mexico municipalities Shapefile"
output: html_notebook
---

```{r}
library(ncdf4)
library(raster)
library(sp)
library(rgeos)
library(rgdal)
library(dismo)
```

```{r}

r<-rotate(raster('gis/noaa_temperatures/air.mon.mean.nc',resolution=2), band=10)
#r<-rotate(raster('gis/noaa_temperatures/air.mon.1981-2010.ltm.nc',resolution=1))
#proj<- "+proj=aea +lat_1=20 +lat_2=60 +lat_0=40 +lon_0=-96 +x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs"

#crs(r)<-proj

e <- extent(-120,-70,0,40)
rc <- crop(r, e)


plot(rc)

```
```{r}
myshp<-readOGR(dsn="gis/shapefiles/conjunto_de_datos/",layer = "areas_geoestadisticas_municipales")

```

```{r}

# tranform both data set to longlat
#myshp<- subset(myshp,CVE_ENT=='01')

rgeo <- projectRaster(rc, crs='+proj=longlat +datum=WGS84')
pgeo <- spTransform(myshp, CRS('+proj=longlat +datum=WGS84'))

# plot on top of Google map

e <- union(extent(rc), extent(pgeo))
print( e)
g <- gmap(e,lonlat=TRUE)
plot(g, inter=TRUE)
plot(extent(rc), add=TRUE, col='red', lwd=2)
plot(pgeo, add=TRUE, col='blue', lwd=2)
```

```{r}
extraction <-extract(rgeo,pgeo, method="simple",fun=mean,small=TRUE,na.rm=TRUE,df=FALSE)
df<-as.data.frame(extraction)

pgeo@data <- data.frame(pgeo@data, means=extraction)
  str(pgeo@data)
spplot(pgeo, "means")
```

